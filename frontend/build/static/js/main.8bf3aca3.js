/*! For license information please see main.8bf3aca3.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,n)=>{var r=n(853),a=n(43),l=n(950);function o(e){var t="https://13c19c9e-804b-4911-b1a3-7e31ff49e079.preview.emergentagent.com","/api"),Ut=(0,a.createContext)(),Bt=e=>{let{children:t}=e;const[n,r]=(0,a.useState)(null),[l,o]=(0,a.useState)(localStorage.getItem("token"));(0,a.useEffect)((()=>{l&&(Rt.defaults.headers.common.Authorization="Bearer ".concat(l),s())}),[l]);const s=async()=>{try{const e=await Rt.get("".concat(It,"/auth/me"));r(e.data)}catch(e){i()}},i=()=>{localStorage.removeItem("token"),o(null),r(null),delete Rt.defaults.headers.common.Authorization};return(0,Lt.jsx)(Ut.Provider,{value:{user:n,login:async e=>{try{const t=await Rt.post("".concat(It,"/auth/login"),{pin:e}),{access_token:n,user:a}=t.data;return localStorage.setItem("token",n),o(n),r(a),Rt.defaults.headers.common.Authorization="Bearer ".concat(n),{success:!0}}catch(a){var t,n;return{success:!1,error:(null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.detail)||"Login failed"}}},logout:i,verifyPin:async e=>{try{return{success:!0,user:(await Rt.post("".concat(It,"/auth/verify-pin"),{pin:e})).data.user}}catch(r){var t,n;return{success:!1,error:(null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.detail)||"Invalid PIN"}}},isAuthenticated:!!n},children:t})},qt=()=>{const e=(0,a.useContext)(Ut);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},$t=()=>{const[e,t]=(0,a.useState)(""),[n,r]=(0,a.useState)(""),[l,o]=(0,a.useState)(!1),{login:s}=qt(),i=n=>{e.length<4&&t(e+n)};return(0,a.useEffect)((()=>{4===e.length&&(async()=>{if(4!==e.length)return void r("Please enter a 4-digit PIN");o(!0),r("");const n=await s(e);n.success||(r(n.error),t("")),o(!1)})()}),[e]),(0,Lt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[(0,Lt.jsxs)("div",{className:"text-center mb-8",children:[(0,Lt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Restaurant POS"}),(0,Lt.jsx)("p",{className:"text-gray-600",children:"Enter your 4-digit PIN"})]}),(0,Lt.jsx)("div",{className:"flex justify-center mb-8",children:(0,Lt.jsx)("div",{className:"flex space-x-3",children:[0,1,2,3].map((t=>(0,Lt.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(t<e.length?"bg-blue-600 border-blue-600":"border-gray-300")},t)))})}),(0,Lt.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[[1,2,3,4,5,6,7,8,9].map((e=>(0,Lt.jsx)("button",{onClick:()=>i(e.toString()),className:"h-16 bg-gray-100 hover:bg-gray-200 rounded-xl text-2xl font-semibold text-gray-800 transition-colors",disabled:l,children:e},e))),(0,Lt.jsx)("button",{onClick:()=>{t(""),r("")},className:"h-16 bg-red-100 hover:bg-red-200 rounded-xl text-sm font-semibold text-red-600 transition-colors",disabled:l,children:"Clear"}),(0,Lt.jsx)("button",{onClick:()=>i("0"),className:"h-16 bg-gray-100 hover:bg-gray-200 rounded-xl text-2xl font-semibold text-gray-800 transition-colors",disabled:l,children:"0"}),(0,Lt.jsx)("button",{onClick:()=>{t(e.slice(0,-1))},className:"h-16 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm font-semibold text-gray-600 transition-colors",disabled:l,children:"\u2190"})]}),n&&(0,Lt.jsx)("div",{className:"text-red-600 text-center text-sm mb-4",children:n}),l&&(0,Lt.jsx)("div",{className:"text-center text-blue-600 text-sm",children:"Logging in..."}),(0,Lt.jsxs)("div",{className:"text-center text-xs text-gray-500 mt-8",children:[(0,Lt.jsx)("strong",{children:"Demo PIN:"})," 1234 (Manager) | 5678 (Employee)"]})]})})},Ht=e=>{let{isOpen:t,onClose:n,onSuccess:r,title:l="Enter PIN to Continue"}=e;const[o,s]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[u,d]=(0,a.useState)(!1),{verifyPin:f}=qt(),p=e=>{o.length<4&&s(o+e)};return(0,a.useEffect)((()=>{4===o.length&&(async()=>{if(4!==o.length)return void c("Please enter a 4-digit PIN");d(!0),c("");const e=await f(o);e.success?(r(e.user),n(),s("")):(c(e.error),s("")),d(!1)})()}),[o]),t?(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[(0,Lt.jsx)("div",{className:"text-center mb-8",children:(0,Lt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:l})}),(0,Lt.jsx)("div",{className:"flex justify-center mb-8",children:(0,Lt.jsx)("div",{className:"flex space-x-3",children:[0,1,2,3].map((e=>(0,Lt.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(e<o.length?"bg-blue-600 border-blue-600":"border-gray-300")},e)))})}),(0,Lt.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[[1,2,3,4,5,6,7,8,9].map((e=>(0,Lt.jsx)("button",{onClick:()=>p(e.toString()),className:"h-12 bg-gray-100 hover:bg-gray-200 rounded-xl text-xl font-semibold text-gray-800 transition-colors",disabled:u,children:e},e))),(0,Lt.jsx)("button",{onClick:()=>{s(""),c("")},className:"h-12 bg-red-100 hover:bg-red-200 rounded-xl text-sm font-semibold text-red-600 transition-colors",disabled:u,children:"Clear"}),(0,Lt.jsx)("button",{onClick:()=>p("0"),className:"h-12 bg-gray-100 hover:bg-gray-200 rounded-xl text-xl font-semibold text-gray-800 transition-colors",disabled:u,children:"0"}),(0,Lt.jsx)("button",{onClick:()=>{s(o.slice(0,-1))},className:"h-12 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm font-semibold text-gray-600 transition-colors",disabled:u,children:"\u2190"})]}),i&&(0,Lt.jsx)("div",{className:"text-red-600 text-center text-sm mb-4",children:i}),(0,Lt.jsx)("div",{className:"flex space-x-3",children:(0,Lt.jsx)("button",{onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"})})]})}):null},Wt=e=>new Date(e),Vt=e=>Wt(e).toLocaleDateString(),Qt=e=>Wt(e).toLocaleTimeString(),Kt=e=>Wt(e).toLocaleString(),Yt=e=>{const t=new Date,n=Wt(e);if(isNaN(n.getTime()))return"Invalid date";const r=Math.abs(t-n),a=Math.floor(r/6e4),l=Math.floor(a/60),o=Math.floor(l/24),s=Math.floor(o/30);return a<1?"just now":a<60?"".concat(a," min ago"):l<24?"".concat(l," hour").concat(l>1?"s":""," ago"):o<30?"".concat(o," day").concat(o>1?"s":""," ago"):"".concat(s," month").concat(s>1?"s":""," ago")},Gt=e=>{const t=new Date,n=Wt(e),r=Math.floor((t-n)/6e4);return r>=45?"bg-red-100 border-red-500 text-red-800":r>=30?"bg-orange-100 border-orange-500 text-orange-800":r>=20?"bg-yellow-100 border-yellow-500 text-yellow-800":"bg-white border-gray-200"},Xt=e=>{let{onBack:t}=e;const[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0),[s,i]=(0,a.useState)(""),[c,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),[h,g]=(0,a.useState)({}),[b,y]=(0,a.useState)([]);(0,a.useEffect)((()=>{x()}),[]);const x=async()=>{try{const e=await Rt.get("".concat(It,"/customers"));r(e.data)}catch(e){console.error("Error fetching customers:",e)}finally{o(!1)}},v=async e=>{u(e),f(!0),await(async e=>{try{const[t,n]=await Promise.all([Rt.get("".concat(It,"/customers/").concat(e,"/stats")),Rt.get("".concat(It,"/customers/").concat(e,"/orders"))]);g(t.data),y(n.data)}catch(t){console.error("Error fetching customer details:",t)}})(e.id)},w=e=>{if(!e)return"Never ordered";const t=Wt(e),n=new Date,r=Math.abs(n-t),a=Math.floor(r/864e5);return 0===a?"Today":1===a?"1 day ago":"".concat(a," days ago")};return l?(0,Lt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Lt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):(0,Lt.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Lt.jsx)("div",{className:"bg-white shadow-sm border-b p-4",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsxs)("button",{onClick:t,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,Lt.jsx)("span",{children:"\u2190"}),(0,Lt.jsx)("span",{children:"Back"})]}),(0,Lt.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Customer Management"})]}),(0,Lt.jsx)("div",{className:"flex items-center space-x-4",children:(0,Lt.jsx)("button",{onClick:()=>m({}),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"Add Customer"})})]})}),(0,Lt.jsxs)("div",{className:"p-6",children:[(0,Lt.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Customers"}),(0,Lt.jsx)("input",{type:"text",placeholder:"Search by name, phone, email, or address...",value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,Lt.jsxs)("div",{className:"text-center",children:[(0,Lt.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:n.length}),(0,Lt.jsx)("div",{className:"text-sm text-gray-600",children:"Total Customers"})]})]})}),(0,Lt.jsx)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:(0,Lt.jsx)("div",{className:"overflow-x-auto",children:(0,Lt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Lt.jsx)("thead",{className:"bg-gray-50",children:(0,Lt.jsxs)("tr",{children:[(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Orders"}),(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Spent"}),(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Order"}),(0,Lt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Lt.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:(s?n.filter((e=>e.name.toLowerCase().includes(s.toLowerCase())||e.phone.includes(s)||e.email.toLowerCase().includes(s.toLowerCase())||e.address.toLowerCase().includes(s.toLowerCase()))):n).map((e=>(0,Lt.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>v(e),children:[(0,Lt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.address&&(0,Lt.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]})}),(0,Lt.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Lt.jsx)("div",{className:"text-sm text-gray-900",children:e.phone}),e.email&&(0,Lt.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]}),(0,Lt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Lt.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.total_orders||0})}),(0,Lt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Lt.jsxs)("span",{className:"text-sm font-medium text-green-600",children:["$",(e.total_spent||0).toFixed(2)]})}),(0,Lt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Lt.jsx)("span",{className:"text-sm text-gray-500",children:w(e.last_order_date)})}),(0,Lt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Lt.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{m(e)})(e)},className:"text-purple-600 hover:text-purple-900",children:"Edit"})})]},e.id)))})]})})})]}),d&&c&&(0,Lt.jsx)(Jt,{customer:c,stats:h,orders:b,onClose:()=>{f(!1),u(null)},onClose:()=>f(!1)}),p&&(0,Lt.jsx)(Zt,{customer:p,onSave:async e=>{try{p?await Rt.put("".concat(It,"/customers/").concat(p.id),e):await Rt.post("".concat(It,"/customers"),e),await x(),m(null)}catch(t){console.error("Error saving customer:",t),alert("Error saving customer")}},onClose:()=>m(null)})]})},Jt=e=>{let{customer:t,stats:n,orders:r,onClose:a,onEdit:l}=e;return(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-4xl w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:t.name}),(0,Lt.jsx)("p",{className:"text-gray-600",children:t.phone})]}),(0,Lt.jsxs)("div",{className:"flex space-x-2",children:[(0,Lt.jsx)("button",{onClick:l,className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"Edit"}),(0,Lt.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]})]}),(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-3",children:"Customer Information"}),(0,Lt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("span",{className:"font-medium",children:"Email:"})," ",t.email||"Not provided"]}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("span",{className:"font-medium",children:"Address:"})," ",t.address||"Not provided"]}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("span",{className:"font-medium",children:"Notes:"})," ",t.notes||"None"]}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("span",{className:"font-medium",children:"Customer Since:"})," ",Vt(t.created_at)]})]})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-3",children:"Statistics"}),(0,Lt.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,Lt.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,Lt.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:n.total_orders||0}),(0,Lt.jsx)("div",{className:"text-blue-700",children:"Total Orders"})]}),(0,Lt.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,Lt.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",(n.total_spent||0).toFixed(2)]}),(0,Lt.jsx)("div",{className:"text-green-700",children:"Total Spent"})]}),(0,Lt.jsxs)("div",{className:"bg-purple-50 p-3 rounded-lg",children:[(0,Lt.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:["$",(n.average_order_value||0).toFixed(2)]}),(0,Lt.jsx)("div",{className:"text-purple-700",children:"Avg Order"})]}),(0,Lt.jsxs)("div",{className:"bg-orange-50 p-3 rounded-lg",children:[(0,Lt.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:null!==n.days_since_last_order?n.days_since_last_order:"N/A"}),(0,Lt.jsx)("div",{className:"text-orange-700",children:"Days Since Last"})]})]})]})]}),(0,Lt.jsxs)("div",{className:"mt-6",children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-3",children:"Recent Orders"}),(0,Lt.jsx)("div",{className:"max-h-48 overflow-y-auto",children:r.length>0?(0,Lt.jsx)("div",{className:"space-y-2",children:r.slice(0,10).map((e=>(0,Lt.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("span",{className:"font-medium",children:e.order_number}),(0,Lt.jsx)("span",{className:"text-gray-500 text-sm ml-2",children:Kt(e.created_at)})]}),(0,Lt.jsxs)("div",{className:"text-right",children:[(0,Lt.jsxs)("div",{className:"font-medium text-green-600",children:["$",e.total.toFixed(2)]}),(0,Lt.jsx)("div",{className:"text-xs text-gray-500",children:e.order_type.replace("_"," ")})]})]},e.id)))}):(0,Lt.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No orders found"})})]})]})})},Zt=e=>{let{customer:t,onSave:n,onClose:r}=e;const[l,o]=(0,a.useState)({name:t.name||"",phone:t.phone||"",email:t.email||"",address:t.address||"",apartment:t.apartment||"",notes:t.notes||""}),s=(e,t)=>{o((n=>u(u({},n),{},{[e]:t})))},i=async e=>{try{const t=(await Rt.get("".concat(It,"/customers/").concat(e))).data;o((e=>u(u({},e),{},{name:t.name||e.name,address:t.address||e.address,apartment:t.apartment||e.apartment,email:t.email||e.email,notes:t.notes||e.notes})))}catch(t){console.log("Customer not found by phone in modal")}},c=async e=>{try{const t=await Rt.get("".concat(It,"/customers")),n=t.data.find((t=>t.address&&t.address.toLowerCase().includes(e.toLowerCase())&&t.address.length>0));n&&o((e=>u(u({},e),{},{name:n.name||e.name,phone:n.phone||e.phone,apartment:n.apartment||e.apartment,email:n.email||e.email,notes:n.notes||e.notes})))}catch(t){console.log("Error looking up customer by address in modal:",t)}};return(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:t.id?"Edit Customer":"Add New Customer"}),(0,Lt.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]}),(0,Lt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.name.trim()&&l.phone.trim()?n(l):alert("Name and phone are required")},className:"space-y-4",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),(0,Lt.jsx)("input",{type:"text",value:l.name,onChange:e=>s("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),(0,Lt.jsx)("input",{type:"tel",value:l.phone,onChange:e=>(async e=>{o((t=>u(u({},t),{},{phone:e}))),e.length>=10&&await i(e)})(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,Lt.jsx)("input",{type:"email",value:l.email,onChange:e=>s("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Lt.jsxs)("div",{className:"md:col-span-2",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address"}),(0,Lt.jsx)("textarea",{value:l.address,onChange:e=>(async e=>{o((t=>u(u({},t),{},{address:e}))),e.length>=10&&await c(e)})(e.target.value),rows:"2",placeholder:"Street address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apartment/Unit"}),(0,Lt.jsx)("input",{type:"text",value:l.apartment,onChange:e=>s("apartment",e.target.value),placeholder:"Apt, Suite, Unit",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,Lt.jsx)("textarea",{value:l.notes,onChange:e=>s("notes",e.target.value),rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Special dietary requirements, preferences, etc."})]}),(0,Lt.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,Lt.jsx)("button",{type:"button",onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{type:"submit",className:"flex-1 bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700",children:t.id?"Update":"Create"})]})]})]})})},en=e=>{let{onBack:t}=e;const[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0),[s,i]=(0,a.useState)("all"),[c,u]=(0,a.useState)("all"),[d,f]=(0,a.useState)(""),[p,m]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1);(0,a.useEffect)((()=>{b()}),[]);const b=async()=>{try{const e=await Rt.get("".concat(It,"/orders"));r(e.data)}catch(e){console.error("Error fetching order history:",e)}finally{o(!1)}},y=()=>{let e=n;"all"!==s&&(e=e.filter((e=>e.status===s)));const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(r.getTime()-864e5),l=new Date(r.getTime()-6048e5);return"today"===c?e=e.filter((e=>Wt(e.created_at)>=r)):"yesterday"===c?e=e.filter((e=>{const t=Wt(e.created_at);return t>=a&&t<r})):"week"===c&&(e=e.filter((e=>Wt(e.created_at)>=l))),d&&(e=e.filter((e=>e.order_number.toLowerCase().includes(d.toLowerCase())||e.customer_name.toLowerCase().includes(d.toLowerCase())||e.customer_phone.includes(d)))),e.sort(((e,t)=>Wt(t.created_at)-Wt(e.created_at)))},x=y();return l?(0,Lt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Lt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Lt.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Lt.jsx)("div",{className:"bg-white shadow-sm border-b p-4",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsxs)("button",{onClick:t,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,Lt.jsx)("span",{children:"\u2190"}),(0,Lt.jsx)("span",{children:"Back"})]}),(0,Lt.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Order History & Transactions"})]}),(0,Lt.jsx)("div",{className:"flex items-center space-x-6",children:(0,Lt.jsxs)("div",{className:"text-center",children:[(0,Lt.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y().length}),(0,Lt.jsx)("div",{className:"text-sm text-gray-600",children:"Orders"})]})})]})}),(0,Lt.jsxs)("div",{className:"p-6",children:[(0,Lt.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,Lt.jsx)("input",{type:"text",placeholder:"Order #, Customer name, Phone",value:d,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,Lt.jsxs)("select",{value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Lt.jsx)("option",{value:"all",children:"All Time"}),(0,Lt.jsx)("option",{value:"today",children:"Today"}),(0,Lt.jsx)("option",{value:"yesterday",children:"Yesterday"}),(0,Lt.jsx)("option",{value:"week",children:"Last 7 Days"})]})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,Lt.jsxs)("select",{value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Lt.jsx)("option",{value:"all",children:"All Orders"}),(0,Lt.jsx)("option",{value:"paid",children:"Paid"}),(0,Lt.jsx)("option",{value:"delivered",children:"Delivered"}),(0,Lt.jsx)("option",{value:"cancelled",children:"Cancelled"}),(0,Lt.jsx)("option",{value:"pending",children:"Pending"}),(0,Lt.jsx)("option",{value:"preparing",children:"Preparing"}),(0,Lt.jsx)("option",{value:"ready",children:"Ready"}),(0,Lt.jsx)("option",{value:"out_for_delivery",children:"Out for Delivery"})]})]}),(0,Lt.jsx)("div",{className:"flex items-end",children:(0,Lt.jsx)("button",{onClick:b,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh"})})]})}),(0,Lt.jsx)("div",{className:"bg-white rounded-2xl shadow-lg",children:(0,Lt.jsxs)("div",{className:"p-6",children:[(0,Lt.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:["Orders (",x.length,")"]}),0===x.length?(0,Lt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,Lt.jsx)("p",{children:"No orders found matching your criteria"})}):(0,Lt.jsx)("div",{className:"overflow-x-auto",children:(0,Lt.jsxs)("table",{className:"w-full table-auto",children:[(0,Lt.jsx)("thead",{children:(0,Lt.jsxs)("tr",{className:"bg-gray-50",children:[(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Order #"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Date & Time"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Customer"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Type"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Items"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Total"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Payment"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),(0,Lt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Actions"})]})}),(0,Lt.jsx)("tbody",{children:x.map((e=>{var t,n;return(0,Lt.jsxs)("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>(e=>{m(e),g(!0)})(e),children:[(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsx)("div",{className:"font-medium text-blue-600",children:e.order_number})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsxs)("div",{className:"text-sm",children:[(0,Lt.jsx)("div",{children:Vt(e.created_at)}),(0,Lt.jsx)("div",{className:"text-gray-500",children:Qt(e.created_at)})]})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsxs)("div",{className:"text-sm",children:[(0,Lt.jsx)("div",{className:"font-medium",children:e.customer_name||"Walk-in"}),e.customer_phone&&(0,Lt.jsx)("div",{className:"text-gray-500",children:e.customer_phone})]})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsxs)("div",{className:"text-sm",children:[(0,Lt.jsx)("div",{className:"font-medium",children:e.order_type.replace("_"," ").toUpperCase()}),e.table_number&&(0,Lt.jsxs)("div",{className:"text-gray-500",children:["Table ",e.table_number]})]})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsxs)("div",{className:"text-sm",children:[(0,Lt.jsxs)("div",{children:[e.items.length," items"]}),(0,Lt.jsxs)("div",{className:"text-gray-500",children:[e.items.slice(0,2).map((e=>e.menu_item_name)).join(", "),e.items.length>2&&"..."]})]})}),(0,Lt.jsxs)("td",{className:"px-4 py-3",children:[(0,Lt.jsxs)("div",{className:"font-medium text-green-600",children:["$",e.total.toFixed(2)]}),e.cash_received&&(0,Lt.jsxs)("div",{className:"text-xs text-gray-500",children:["Cash: $",e.cash_received.toFixed(2),e.change_amount>0&&(0,Lt.jsxs)("div",{children:["Change: $",e.change_amount.toFixed(2)]})]})]}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsxs)("div",{className:"text-sm",children:[(0,Lt.jsx)("div",{className:"font-medium",children:(null===(t=e.payment_method)||void 0===t?void 0:t.toUpperCase())||"Pending"}),(0,Lt.jsx)("div",{className:"text-gray-500",children:e.payment_status})]})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium rounded-full ".concat((n=e.status,{draft:"bg-gray-100 text-gray-800",pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-orange-100 text-orange-800",ready:"bg-green-100 text-green-800",out_for_delivery:"bg-purple-100 text-purple-800",delivered:"bg-green-200 text-green-900",paid:"bg-emerald-200 text-emerald-900",cancelled:"bg-red-100 text-red-800"}[n]||"bg-gray-100 text-gray-800")),children:e.status.replace("_"," ").toUpperCase()})}),(0,Lt.jsx)("td",{className:"px-4 py-3",children:(0,Lt.jsx)("div",{className:"flex space-x-2",children:"paid"===e.status&&(0,Lt.jsx)("button",{onClick:t=>{t.stopPropagation(),console.log("Print receipt for:",e),alert("Receipt for ".concat(e.order_number," sent to printer"))},className:"text-green-600 hover:text-green-800 text-sm",children:"Print"})})})]},e.id)}))})]})})]})})]}),h&&p&&(0,Lt.jsx)(un,{order:p,onClose:()=>{g(!1),m(null)}})]})},tn=e=>{let{onOrderClick:t,refreshTrigger:n}=e;const[r,l]=(0,a.useState)([]),[o,s]=(0,a.useState)(!0),[i,c]=(0,a.useState)(new Date),[u,d]=(0,a.useState)("all"),[f,p]=(0,a.useState)(new Set),[m,h]=(0,a.useState)(!1),[g,b]=(0,a.useState)(!1);(0,a.useEffect)((()=>{y();const e=setInterval(y,3e4);return()=>clearInterval(e)}),[n]),(0,a.useEffect)((()=>{const e=setInterval((()=>{c(new Date)}),3e4);return()=>clearInterval(e)}),[]);const y=async()=>{try{const e=await Rt.get("".concat(It,"/orders/active"));l(e.data)}catch(e){console.error("Error fetching orders:",e)}finally{s(!1)}},x=e=>{const t=new Set(f);t.has(e)?t.delete(e):t.add(e),p(t)},v=()=>{b(!g),p(new Set)},w=e=>({confirmed:"preparing",preparing:"ready",ready:"out_for_delivery",out_for_delivery:"delivered"}[e]),k="all"===u?r:r.filter((e=>e.order_type===u));return o?(0,Lt.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Active Orders"}),(0,Lt.jsx)("div",{className:"flex justify-center py-8",children:(0,Lt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})]}):(0,Lt.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Active Orders"}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsx)("div",{className:"flex items-center space-x-2",children:g?(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("input",{type:"checkbox",checked:f.size>0&&f.size===r.filter((e=>"paid"!==e.status&&"delivered"!==e.status&&"cancelled"!==e.status)).length,onChange:()=>{const e=r.filter((e=>"paid"!==e.status&&"delivered"!==e.status&&"cancelled"!==e.status));f.size===e.length?p(new Set):p(new Set(e.map((e=>e.id))))},className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),(0,Lt.jsx)("span",{className:"text-sm text-gray-700",children:"Select All"})]}),f.size>0&&(0,Lt.jsxs)("button",{onClick:()=>{0!==f.size?h(!0):alert("Please select orders to cancel")},className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm font-medium",children:["Cancel Selected (",f.size,")"]}),(0,Lt.jsx)("button",{onClick:v,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 text-sm font-medium",children:"Done"})]}):(0,Lt.jsx)("button",{onClick:v,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Select"})}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Filter:"}),(0,Lt.jsxs)("select",{value:u,onChange:e=>d(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Lt.jsx)("option",{value:"all",children:"All Orders"}),(0,Lt.jsx)("option",{value:"dine_in",children:"Dine In"}),(0,Lt.jsx)("option",{value:"takeout",children:"Takeout"}),(0,Lt.jsx)("option",{value:"delivery",children:"Delivery"}),(0,Lt.jsx)("option",{value:"phone_order",children:"Phone Order"})]})]})]})]}),0===k.length?(0,Lt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,Lt.jsx)("p",{children:"No active orders"})}):(0,Lt.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:k.map((e=>{return(0,Lt.jsxs)("div",{className:"border-2 rounded-xl p-4 transition-all hover:shadow-md ".concat(Gt(e.created_at)," ").concat(f.has(e.id)?"ring-2 ring-red-500":""," ").concat(g?"":"cursor-pointer"),onClick:()=>(e=>{g?x(e.id):t(e)})(e),children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,Lt.jsxs)("div",{className:"flex items-start space-x-3",children:[g&&"paid"!==e.status&&"delivered"!==e.status&&"cancelled"!==e.status&&(0,Lt.jsx)("input",{type:"checkbox",checked:f.has(e.id),onChange:()=>x(e.id),onClick:e=>e.stopPropagation(),className:"mt-1 rounded border-gray-300 text-red-600 focus:ring-red-500"}),(0,Lt.jsxs)("div",{className:"flex-1",children:[(0,Lt.jsx)("h4",{className:"font-bold text-lg",children:e.order_number}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600",children:Qt(e.created_at)}),(0,Lt.jsxs)("p",{className:"text-xs font-semibold text-orange-600",children:["\u23f1\ufe0f ",Yt(e.created_at)]})]})]}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:["pending"!==e.status&&(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsx)("span",{className:"inline-block w-3 h-3 rounded-full ".concat((r=e.status,{confirmed:"bg-blue-500",preparing:"bg-orange-500",ready:"bg-green-500",out_for_delivery:"bg-purple-500"}[r]||"bg-gray-500"))}),(0,Lt.jsx)("span",{className:"text-xs font-medium capitalize",children:e.status.replace("_"," ")})]}),"pending"===e.status&&(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full",children:"PENDING"})]})]}),(0,Lt.jsxs)("div",{className:"mb-3",children:[(0,Lt.jsxs)("p",{className:"text-sm font-medium",children:[e.order_type.replace("_"," ").toUpperCase(),e.table_number&&" - Table ".concat(e.table_number),"delivery"===e.order_type&&e.customer_address&&" - ".concat(e.customer_address.substring(0,30),"...")]}),e.customer_name&&(0,Lt.jsx)("p",{className:"text-sm text-gray-600",children:e.customer_name})]}),(0,Lt.jsxs)("div",{className:"mb-3 text-sm",children:[e.items.slice(0,2).map(((e,t)=>(0,Lt.jsx)("div",{className:"flex justify-between",children:(0,Lt.jsxs)("span",{children:[e.quantity,"x ",e.menu_item_name]})},t))),e.items.length>2&&(0,Lt.jsxs)("p",{className:"text-gray-500",children:["+",e.items.length-2," more items"]})]}),(0,Lt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lt.jsxs)("span",{className:"font-bold text-lg",children:["$",e.total.toFixed(2)]}),(0,Lt.jsx)("div",{className:"flex space-x-2",children:"delivery"===e.order_type&&"pending"!==e.status&&w(e.status)&&(0,Lt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async(e,t)=>{try{await Rt.put("".concat(It,"/orders/").concat(e,"/status"),{status:t}),y()}catch(n){console.error("Error updating order status:",n)}})(e.id,w(e.status))},className:"bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 transition-colors",children:(n=e.status,{confirmed:"Start Prep",preparing:"Ready",ready:"Out for Delivery",out_for_delivery:"Delivered"}[n])})})]})]},e.id);var n,r}))}),m&&(0,Lt.jsx)(nn,{selectedOrders:Array.from(f),onCancel:()=>h(!1),onConfirm:async(e,t)=>{try{const n=Array.from(f).map((n=>Rt.post("".concat(It,"/orders/").concat(n,"/cancel"),{reason:e,notes:t})));await Promise.all(n),alert("".concat(f.size," order(s) cancelled successfully")),p(new Set),h(!1),y()}catch(n){console.error("Error cancelling orders:",n),alert("Error cancelling some orders. Please try again.")}}})]})},nn=e=>{let{selectedOrders:t,onCancel:n,onConfirm:r}=e;const[l,o]=(0,a.useState)("customer_canceled"),[s,i]=(0,a.useState)("");return(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Cancel Orders"}),(0,Lt.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsxs)("p",{className:"text-gray-600 mb-4",children:["You are about to cancel ",t.length," order(s). Please select a reason:"]}),(0,Lt.jsx)("div",{className:"space-y-3",children:[{value:"customer_canceled",label:"Customer Canceled"},{value:"wrong_order",label:"Wrong Order"},{value:"other",label:"Other"}].map((e=>(0,Lt.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,Lt.jsx)("input",{type:"radio",value:e.value,checked:l===e.value,onChange:e=>o(e.target.value),className:"text-red-600 focus:ring-red-500"}),(0,Lt.jsx)("span",{className:"text-gray-700",children:e.label})]},e.value)))})]}),"other"===l&&(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Please specify the reason:"}),(0,Lt.jsx)("textarea",{value:s,onChange:e=>i(e.target.value),rows:"3",placeholder:"Enter the reason for cancellation...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{onClick:()=>{const e="other"===l?s:"";"other"!==l||s.trim()?r(l,e):alert("Please provide a reason for cancellation")},className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:"Confirm Cancellation"})]})]})})},rn=()=>{const[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)(!1);(0,a.useEffect)((()=>{l&&s()}),[l]);const s=async()=>{try{const e=await Rt.get("".concat(It,"/time/active-employees"));t(e.data.active_employees)}catch(e){console.error("Error fetching active employees:",e)}finally{r(!1)}};return(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsx)("button",{onClick:()=>o(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Employee Status"}),l&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold",children:"Active Employees"}),(0,Lt.jsx)("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]}),n?(0,Lt.jsx)("div",{className:"flex justify-center py-8",children:(0,Lt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===e.length?(0,Lt.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No employees currently clocked in"}):(0,Lt.jsx)("div",{className:"space-y-3",children:e.map((e=>(0,Lt.jsx)("div",{className:"bg-gray-50 rounded-lg p-3",children:(0,Lt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium",children:e.full_name}),(0,Lt.jsxs)("p",{className:"text-sm text-gray-600",children:["Clocked in: ",new Date(e.clock_in_time).toLocaleTimeString()]})]}),(0,Lt.jsxs)("div",{className:"text-right",children:[(0,Lt.jsxs)("p",{className:"text-sm font-medium text-green-600",children:[e.active_hours.toFixed(1),"h"]}),(0,Lt.jsx)("p",{className:"text-xs text-gray-500",children:"Active"})]})]})},e.user_id)))})]})})]})},an=()=>{const[e,t]=(0,a.useState)(!1),[n,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),[s,i]=(0,a.useState)(null),[c,u]=(0,a.useState)([]),[d,f]=(0,a.useState)(null);(0,a.useEffect)((()=>{p()}),[]);const p=async()=>{try{const e=await Rt.get("".concat(It,"/time/entries"));u(e.data);const t=(new Date).toISOString().split("T")[0],n=e.data.find((e=>e.date===t&&!e.clock_out));f(n)}catch(e){console.error("Error checking clock status:",e)}};return(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsx)("button",{onClick:()=>(i(d?"out":"in"),void o(!0)),className:"px-4 py-2 rounded-lg transition-colors ".concat(d?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"),disabled:e||n,children:e||n?"Processing...":d?"Clock Out":"Clock In"}),(0,Lt.jsx)(Ht,{isOpen:l,onClose:()=>o(!1),onSuccess:async e=>{try{if("in"===s)t(!0),await Rt.post("".concat(It,"/time/clock-in")),alert("Clocked in successfully!");else{r(!0);const e=await Rt.post("".concat(It,"/time/clock-out"));alert("Clocked out successfully! Total hours: ".concat(e.data.total_hours.toFixed(2)))}p(),o(!1)}catch(l){var n,a;alert((null===(n=l.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.detail)||"Error processing clock action")}finally{t(!1),r(!1)}},title:"in"===s?"Clock In":"Clock Out"})]})},ln=e=>{let{onTableSelect:t}=e;const[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(!1),[s,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(!1),[p,m]=(0,a.useState)("select-source"),[h,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)([]),[x,v]=(0,a.useState)(!1);(0,a.useEffect)((()=>{w()}),[]);const w=async()=>{try{const e=await Rt.get("".concat(It,"/tables"));r(e.data)}catch(e){console.error("Error fetching tables:",e)}},k=async(e,t)=>{try{const n={status:t};"available"===t&&(n.current_order_id=null),await Rt.put("".concat(It,"/tables/").concat(e),n),w()}catch(n){console.error("Error updating table:",n)}},S=()=>{o(!1),i(null),u(null),m("select-source"),f(!1)},N=e=>{u(e),"occupied"===e.status?f(!0):(async(e,t)=>{try{await Rt.post("".concat(It,"/tables/").concat(e,"/move"),{new_table_id:t}),w(),S(),alert("Order moved successfully!")}catch(a){var n,r;alert((null===(n=a.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.detail)||"Error moving order")}})(s.id,e.id)},j=n.filter((e=>"occupied"===e.status)),C=n.filter((e=>"available"===e.status));return(0,Lt.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Table Management"}),(0,Lt.jsx)("div",{className:"flex space-x-2",children:j.length>0&&(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsx)("button",{onClick:()=>{o(!0),m("select-source")},className:"bg-purple-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-purple-700",children:"Move Order"}),(0,Lt.jsx)("button",{onClick:()=>{v(!0),y([])},className:"bg-red-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-700",children:"Cancel Table"})]})})]}),(0,Lt.jsx)("div",{className:"grid grid-cols-5 gap-3",children:n.map((e=>{return(0,Lt.jsx)("div",{className:"border-2 rounded-xl p-4 cursor-pointer transition-all hover:shadow-md ".concat((n=e.status,{available:"bg-green-100 border-green-500 text-green-800",occupied:"bg-red-100 border-red-500 text-red-800",needs_cleaning:"bg-yellow-100 border-yellow-500 text-yellow-800",reserved:"bg-blue-100 border-blue-500 text-blue-800",problem:"bg-gray-100 border-gray-500 text-gray-800"}[n]||"bg-gray-100 border-gray-300")),onClick:()=>t(e),children:(0,Lt.jsxs)("div",{className:"text-center",children:[(0,Lt.jsx)("div",{className:"text-2xl font-bold mb-1",children:e.number}),(0,Lt.jsx)("div",{className:"text-xs capitalize",children:e.status.replace("_"," ")})]})},e.id);var n}))}),l&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:["select-source"===p&&(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Select Table to Move"}),(0,Lt.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-4",children:j.map((e=>(0,Lt.jsxs)("button",{onClick:()=>(e=>{i(e),m("select-destination")})(e),className:"bg-red-100 border-2 border-red-500 text-red-800 p-3 rounded-lg hover:bg-red-200",children:["Table ",e.number]},e.id)))}),0===j.length&&(0,Lt.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No occupied tables to move"})]}),"select-destination"===p&&s&&(0,Lt.jsxs)(Lt.Fragment,{children:[(0,Lt.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Move Table ",s.number," to:"]}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("h4",{className:"text-md font-semibold mb-2 text-green-600",children:"Available Tables"}),(0,Lt.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-4",children:C.map((e=>(0,Lt.jsxs)("button",{onClick:()=>N(e),className:"bg-green-100 border-2 border-green-500 text-green-800 p-3 rounded-lg hover:bg-green-200",children:["Table ",e.number]},e.id)))})]}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("h4",{className:"text-md font-semibold mb-2 text-red-600",children:"Occupied Tables (Merge)"}),(0,Lt.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-4",children:j.filter((e=>e.id!==s.id)).map((e=>(0,Lt.jsxs)("button",{onClick:()=>N(e),className:"bg-red-100 border-2 border-red-500 text-red-800 p-3 rounded-lg hover:bg-red-200",children:["Table ",e.number]},e.id)))})]}),(0,Lt.jsx)("button",{onClick:()=>m("select-source"),className:"w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 mb-2",children:"\u2190 Back"})]}),(0,Lt.jsx)("button",{onClick:S,className:"w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"})]})}),d&&s&&c&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold mb-4 text-orange-600",children:"\u26a0\ufe0f Table Occupied"}),(0,Lt.jsxs)("p",{className:"mb-4",children:["Table ",c.number," is already occupied with an order. Do you want to ",(0,Lt.jsx)("strong",{children:"merge"})," the orders from Table ",s.number,"into Table ",c.number,"?"]}),(0,Lt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:(0,Lt.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,Lt.jsx)("strong",{children:"Note:"})," This will combine all items from both tables into one order on Table ",c.number,". Table ",s.number," will become available."]})}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:()=>f(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{onClick:()=>(async(e,t)=>{try{await Rt.post("".concat(It,"/tables/").concat(e,"/merge"),{new_table_id:t}),w(),S(),f(!1),alert("Orders merged successfully!")}catch(a){var n,r;alert((null===(n=a.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.detail)||"Error merging orders")}})(s.id,c.id),className:"flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700",children:"Merge Orders"})]})]})}),x&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold mb-4 text-red-600",children:"Select Tables to Cancel"}),(0,Lt.jsx)("p",{className:"mb-4 text-gray-600",children:"Select one or more occupied tables to cancel their orders and free them up."}),(0,Lt.jsx)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:j.map((e=>(0,Lt.jsx)("div",{onClick:()=>{const t=b.includes(e.id);y(t?t=>t.filter((t=>t!==e.id)):t=>[...t,e.id])},className:"p-4 rounded-lg border-2 cursor-pointer transition-all ".concat(b.includes(e.id)?"border-red-500 bg-red-50 text-red-700":"border-gray-300 bg-gray-50 text-gray-700 hover:border-red-300"),children:(0,Lt.jsxs)("div",{className:"text-center",children:[(0,Lt.jsxs)("div",{className:"text-xl font-bold",children:["Table ",e.number]}),(0,Lt.jsx)("div",{className:"text-sm",children:"Occupied"}),b.includes(e.id)&&(0,Lt.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"\u2713 Selected"})]})},e.id)))}),0===j.length&&(0,Lt.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No occupied tables to cancel"}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:()=>{v(!1),y([])},className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),b.length>0&&(0,Lt.jsxs)("button",{onClick:()=>{v(!1),g(!0)},className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:["Cancel Selected (",b.length,")"]})]})]})}),h&&b.length>0&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold mb-4 text-red-600",children:"Confirm Table Cancellation"}),(0,Lt.jsxs)("p",{className:"mb-4",children:["Are you sure you want to cancel ",b.length," table(s)? This will cancel the associated orders and free up the tables."]}),(0,Lt.jsxs)("div",{className:"mb-4 bg-gray-50 rounded-lg p-3",children:[(0,Lt.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tables to cancel:"}),(0,Lt.jsx)("div",{className:"text-sm text-gray-600",children:b.map((e=>{const t=n.find((t=>t.id===e));return t?"Table ".concat(t.number):""})).filter(Boolean).join(", ")})]}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:()=>{g(!1),y([])},className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{onClick:async()=>{try{for(const e of b){const t=n.find((t=>t.id===e));t&&t.current_order_id&&await Rt.post("".concat(It,"/orders/").concat(t.current_order_id,"/cancel"),{reason:"other",notes:"Table ".concat(t.number," cancelled via table management")}),await k(e,"available")}g(!1),y([]),alert("".concat(b.length," table(s) cancelled successfully"))}catch(e){console.error("Error cancelling tables:",e),alert("Error cancelling tables")}},className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:"Confirm Cancel"})]})]})})]})},on=e=>{let{isOpen:t,order:n,onClose:r,onPaymentComplete:l}=e;const[o,s]=(0,a.useState)("card"),[i,c]=(0,a.useState)(""),[d,f]=(0,a.useState)(""),[p,m]=(0,a.useState)(!0),[h,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[x,v]=(0,a.useState)(null),{printOrderReceipt:w,connected:k,openPrinterManager:S}=Ft();return t&&n?(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Process Payment"}),(0,Lt.jsx)("div",{className:"mb-4",children:(0,Lt.jsxs)("h4",{className:"font-medium mb-2",children:["Order Total: $",n.total.toFixed(2)]})}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),(0,Lt.jsxs)("div",{className:"flex space-x-2",children:[(0,Lt.jsx)("button",{onClick:()=>s("card"),className:"flex-1 py-2 px-4 rounded-lg border ".concat("card"===o?"bg-blue-600 text-white":"bg-white text-gray-700 border-gray-300"),children:"Card"}),(0,Lt.jsx)("button",{onClick:()=>s("cash"),className:"flex-1 py-2 px-4 rounded-lg border ".concat("cash"===o?"bg-blue-600 text-white":"bg-white text-gray-700 border-gray-300"),children:"Cash"})]})]}),"cash"===o&&(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cash Received"}),(0,Lt.jsx)("input",{type:"number",step:"0.01",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),i&&(0,Lt.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Change: $",("cash"===o&&i?Math.max(0,parseFloat(i)-n.total):0).toFixed(2)]})]}),(0,Lt.jsxs)("div",{className:"mb-6",children:[(0,Lt.jsxs)("div",{className:"flex items-center mb-2",children:[(0,Lt.jsx)("input",{type:"checkbox",checked:p,onChange:e=>m(e.target.checked),className:"mr-2"}),(0,Lt.jsx)("label",{className:"text-sm",children:"Print Receipt"})]}),p&&(0,Lt.jsx)("div",{className:"mb-2 p-2 bg-gray-50 rounded-lg",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsxs)("div",{className:"text-xs",children:[(0,Lt.jsx)("span",{className:"font-medium",children:"Printer: "}),(0,Lt.jsx)("span",{className:k?"text-green-600":"text-red-600",children:k?"Connected":"Not Connected"})]}),!k&&(0,Lt.jsx)("button",{onClick:S,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700",children:"Setup"})]})}),(0,Lt.jsxs)("div",{className:"mb-2",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Receipt (optional)"}),(0,Lt.jsx)("input",{type:"email",value:d,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"customer@email.com"})]})]}),b&&x&&(0,Lt.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsx)("span",{className:"text-sm text-green-700",children:"Payment successful!"}),(0,Lt.jsx)("button",{onClick:async()=>{if(x)try{await w(x)}catch(e){alert("Print failed. Please check printer connection.")}},className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"\ud83d\udda8\ufe0f Print Receipt"})]})}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",disabled:h,children:"Cancel"}),(0,Lt.jsx)("button",{onClick:async()=>{g(!0);try{await Rt.put("".concat(It,"/orders/").concat(n.id,"/status"),{status:"pending"}),alert("Order marked as pay later - moved to active orders"),l(),r()}catch(a){var e,t;alert((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error processing pay later")}finally{g(!1)}},className:"flex-1 bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700",disabled:h,children:"Pay Later"}),(0,Lt.jsx)("button",{onClick:async()=>{if("cash"===o&&parseFloat(i)<n.total)alert("Cash received is less than total amount");else{g(!0);try{const e={payment_method:o,cash_received:"cash"===o?parseFloat(i):null,email_receipt:d||null,print_receipt:p},t=await Rt.post("".concat(It,"/orders/").concat(n.id,"/pay"),e),s=u(u({},n),{},{payment_method:o,change_amount:t.data.change_amount||0,paid_at:(new Date).toISOString()});if(v(s),alert("Payment successful! ".concat("cash"===o?"Change: $".concat(t.data.change_amount.toFixed(2)):"")),p&&k)try{await w(s)}catch(a){console.error("Auto-print failed:",a)}p&&(y(!0),setTimeout((()=>y(!1)),1e4)),setTimeout((()=>{l(),r(),y(!1),v(null)}),b?3e3:1e3)}catch(a){var e,t;alert((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Payment failed")}finally{g(!1)}}},className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700",disabled:h||"cash"===o&&(!i||parseFloat(i)<n.total),children:h?"Processing...":"Pay Now"})]})]})}):null},sn=e=>{let{isOpen:t,onClose:n,onRemove:r}=e;const[l,o]=(0,a.useState)("wrong_item"),[s,i]=(0,a.useState)("");return t?(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Remove Item - Reason Required"}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),(0,Lt.jsxs)("select",{value:l,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Lt.jsx)("option",{value:"wrong_item",children:"Wrong Item Selected"}),(0,Lt.jsx)("option",{value:"customer_changed_mind",children:"Customer Changed Mind"}),(0,Lt.jsx)("option",{value:"other",children:"Other"})]})]}),(0,Lt.jsxs)("div",{className:"mb-6",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),(0,Lt.jsx)("textarea",{value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Additional details..."})]}),(0,Lt.jsxs)("div",{className:"flex space-x-3",children:[(0,Lt.jsx)("button",{onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{onClick:()=>{r({reason:l,notes:s}),o("wrong_item"),i(""),n()},className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700",children:"Remove Item"})]})]})}):null},cn=e=>{let{selectedTable:t,editingOrder:n,editingActiveOrder:r,onBack:l,fromTableManagement:o=!1}=e;const{printOrderReceipt:s,connected:i,openPrinterManager:c}=Ft(),[d,f]=(0,a.useState)([]),[p,m]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[b,y]=(0,a.useState)([]),[x,v]=(0,a.useState)("all"),[w,k]=(0,a.useState)([]),[S,N]=(0,a.useState)(null),[j,C]=(0,a.useState)({name:"",phone:"",address:"",apartment:""}),[_,E]=(0,a.useState)(!1),[P,T]=(0,a.useState)(o||t?"dine_in":"takeout"),[O,R]=(0,a.useState)(0),[A,z]=(0,a.useState)(!1),[L,D]=(0,a.useState)(null),[F,M]=(0,a.useState)({}),[I,U]=(0,a.useState)(!1),[B,q]=(0,a.useState)(!1),[$,H]=(0,a.useState)(null),[W,V]=(0,a.useState)(""),[Q,K]=(0,a.useState)(!1),[Y,G]=(0,a.useState)(!1),[X,J]=(0,a.useState)(t||null),[Z,ee]=(0,a.useState)([]),te=async e=>{try{const t=(await Rt.get("".concat(It,"/customers/").concat(e))).data;C((e=>u(u({},e),{},{name:t.name||e.name,address:t.address||e.address,apartment:t.apartment||e.apartment}))),E(!0)}catch(t){console.log("Customer not found by phone, continuing with manual entry")}},ne=async e=>{try{const t=await Rt.get("".concat(It,"/customers")),n=t.data.find((t=>t.address&&t.address.toLowerCase().includes(e.toLowerCase())&&t.address.length>0));n&&(C((e=>u(u({},e),{},{name:n.name||e.name,phone:n.phone||e.phone,apartment:n.apartment||e.apartment}))),E(!0))}catch(t){console.log("Error looking up customer by address:",t)}};(0,a.useEffect)((()=>{n?ae():r&&le(),oe(),se(),ie(),re()}),[n,r]);const re=async()=>{try{const e=await Rt.get("".concat(It,"/tables"));ee(e.data)}catch(e){console.error("Error fetching tables:",e)}},ae=async()=>{try{const e=(await Rt.get("".concat(It,"/orders/").concat(n.current_order_id))).data;N(e),k(e.items),C({name:e.customer_name,phone:e.customer_phone,address:e.customer_address}),T(e.order_type)}catch(e){console.error("Error loading existing order:",e)}},le=()=>{const e=r;N(e),k(e.items),C({name:e.customer_name,phone:e.customer_phone,address:e.customer_address}),T(e.order_type)},oe=async()=>{try{const e=await Rt.get("".concat(It,"/menu/items"));f(e.data)}catch(e){console.error("Error fetching menu items:",e)}},se=async()=>{try{const e=await Rt.get("".concat(It,"/menu/categories"));y(e.data.categories)}catch(e){console.error("Error fetching categories:",e)}},ie=async()=>{try{const[e,t]=await Promise.all([Rt.get("".concat(It,"/modifiers/groups")),Rt.get("".concat(It,"/modifiers"))]);m(e.data),g(t.data)}catch(e){console.error("Error fetching modifier data:",e)}},ce=(e,t)=>{if(t<=0)return void ue(e);const n=[...w];n[e].quantity=t;const r=n[e].modifiers.reduce(((e,t)=>e+t.price),0);n[e].total_price=(n[e].base_price+r)*t,k(n)},ue=e=>{H(e),q(!0)},de=()=>{const e=w.reduce(((e,t)=>e+t.total_price),0),t=.08*e;return{subtotal:e,tax:t,total:e+t}},fe=async()=>{if(0!==w.length){if(j.phone&&j.name&&!S)try{await Rt.get("".concat(It,"/customers/").concat(j.phone))}catch(n){var e;if(404===(null===(e=n.response)||void 0===e?void 0:e.status))try{const e={name:j.name,phone:j.phone,address:j.address||"",email:"",notes:"Auto-created from order on ".concat((new Date).toLocaleDateString())};await Rt.post("".concat(It,"/customers"),e),console.log("New customer auto-created successfully")}catch(r){console.error("Error auto-creating customer:",r)}}try{const e={customer_name:j.name,customer_phone:j.phone,customer_address:j.address,table_id:(null===X||void 0===X?void 0:X.id)||(null===t||void 0===t?void 0:t.id)||null,items:w.map((e=>({menu_item_id:e.menu_item_id,quantity:e.quantity,modifiers:e.modifiers,special_instructions:""}))),order_type:P,tip:0,delivery_instructions:"",order_notes:W},n=await Rt.post("".concat(It,"/orders"),e);return N(n.data),n.data}catch(n){return console.error("Error creating order:",n),alert("Error creating order. Please try again."),null}}else alert("Please add items to your order")},pe=async()=>{if(S)try{const e={customer_name:j.name,customer_phone:j.phone,customer_address:j.address,table_id:(null===t||void 0===t?void 0:t.id)||S.table_id,items:w.map((e=>({menu_item_id:e.menu_item_id,quantity:e.quantity,modifiers:e.modifiers,special_instructions:""}))),order_type:P,tip:0,delivery_instructions:"",order_notes:W},n=(await Rt.put("".concat(It,"/orders/").concat(S.id),e)).data;return N(n),n}catch(e){throw console.error("Error updating order:",e),e}},me="all"===x?d:d.filter((e=>e.category===x)),{subtotal:he,tax:ge,total:be}=de();return(0,Lt.jsxs)("div",{className:"bg-gray-50 min-h-screen",children:[(0,Lt.jsx)("div",{className:"bg-white shadow-sm border-b p-4",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsxs)("button",{onClick:l,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,Lt.jsx)("span",{children:"\u2190"}),(0,Lt.jsx)("span",{children:"Back"})]}),(0,Lt.jsx)("h1",{className:"text-xl font-bold",children:n?"Edit Table ".concat(n.number," Order"):r?"Edit Order ".concat(r.order_number):t?"New Order - Table ".concat(t.number):"New Order"}),(0,Lt.jsxs)("div",{className:"text-right",children:[(0,Lt.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",be.toFixed(2)]}),(0,Lt.jsxs)("div",{className:"text-sm text-gray-600",children:[w.length," items"]})]})]})}),(0,Lt.jsxs)("div",{className:"flex h-screen",children:[(0,Lt.jsxs)("div",{className:"flex-1 p-6",children:[!o&&(0,Lt.jsx)("div",{className:"mb-6",children:(0,Lt.jsx)("div",{className:"flex space-x-2",children:[{value:"dine_in",label:"Dine In"},{value:"takeout",label:"Takeout"},{value:"delivery",label:"Delivery"}].map((e=>(0,Lt.jsx)("button",{onClick:()=>T(e.value),className:"px-4 py-2 rounded-lg font-medium ".concat(P===e.value?"bg-blue-600 text-white":"bg-white text-gray-700 border hover:bg-gray-50"),children:e.label},e.value)))})}),o&&(0,Lt.jsx)("div",{className:"mb-6",children:(0,Lt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Lt.jsx)("span",{className:"text-blue-800 font-medium",children:"Order Type: Dine In"}),(0,Lt.jsx)("span",{className:"text-blue-600 text-sm ml-2",children:"(Table Management Mode)"})]})}),"dine_in"===P&&(0,Lt.jsxs)("div",{className:"mb-6 bg-white rounded-xl p-4",children:[(0,Lt.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Selected Table"}),X?(0,Lt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsxs)("span",{className:"font-medium",children:["Table ",X.number]}),(0,Lt.jsxs)("span",{className:"text-sm text-gray-600 ml-2",children:["(",X.status,")"]})]}),!o&&(0,Lt.jsx)("button",{onClick:()=>G(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Change Table"})]}):(0,Lt.jsx)("div",{className:"text-center",children:(0,Lt.jsx)("button",{onClick:()=>G(!0),className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 text-lg font-medium",children:"Choose Table"})})]}),"delivery"===P&&(0,Lt.jsx)("div",{className:"mb-6 bg-white rounded-xl p-4",children:_?(0,Lt.jsxs)("div",{children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lt.jsx)("h3",{className:"font-bold text-lg",children:"Customer Information"}),(0,Lt.jsx)("button",{onClick:()=>K(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Edit Customer"})]}),(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Name"}),(0,Lt.jsx)("input",{type:"text",placeholder:"Customer Name",value:j.name,onChange:e=>C(u(u({},j),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,Lt.jsx)("input",{type:"tel",placeholder:"Phone Number",value:j.phone,onChange:e=>(async e=>{C((t=>u(u({},t),{},{phone:e}))),e.length>=10&&await te(e)})(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Lt.jsxs)("div",{className:"md:col-span-2",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address"}),(0,Lt.jsx)("input",{type:"text",placeholder:"Street Address",value:j.address,onChange:e=>(async e=>{C((t=>u(u({},t),{},{address:e}))),e.length>=10&&await ne(e)})(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apartment/Unit"}),(0,Lt.jsx)("input",{type:"text",placeholder:"Apt, Suite, Unit",value:j.apartment,onChange:e=>C(u(u({},j),{},{apartment:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}):(0,Lt.jsx)("div",{className:"text-center",children:(0,Lt.jsx)("button",{onClick:()=>K(!0),className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 text-lg font-medium",children:"+ Add Customer"})})}),(0,Lt.jsx)("div",{className:"mb-6",children:(0,Lt.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,Lt.jsx)("button",{onClick:()=>v("all"),className:"px-4 py-2 rounded-lg ".concat("all"===x?"bg-blue-600 text-white":"bg-white text-gray-700 border hover:bg-gray-50"),children:"All"}),b.map((e=>(0,Lt.jsx)("button",{onClick:()=>v(e),className:"px-4 py-2 rounded-lg ".concat(x===e?"bg-blue-600 text-white":"bg-white text-gray-700 border hover:bg-gray-50"),children:e},e)))]})}),(0,Lt.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:me.map((e=>(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.image_url&&(0,Lt.jsx)("img",{src:e.image_url,alt:e.name,className:"w-full h-32 object-cover rounded-lg mb-3"}),(0,Lt.jsx)("h3",{className:"font-semibold text-gray-800 mb-1",children:e.name}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),(0,Lt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lt.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",e.price.toFixed(2)]}),(0,Lt.jsx)("button",{onClick:()=>(e=>{if(e.modifier_groups&&e.modifier_groups.length>0)D(e),M({}),z(!0);else{const t={menu_item_id:e.id,menu_item_name:e.name,quantity:1,base_price:e.price,modifiers:[],total_price:e.price},n=w.findIndex((t=>t.menu_item_id===e.id&&0===t.modifiers.length));if(n>=0){const e=[...w];e[n].quantity+=1,e[n].total_price=e[n].base_price*e[n].quantity,k(e)}else k([...w,t])}})(e),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Add"})]})]},e.id)))})]}),(0,Lt.jsxs)("div",{className:"w-96 bg-white shadow-lg p-6 overflow-y-auto",children:[(0,Lt.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Order Summary"}),(0,Lt.jsx)("div",{className:"space-y-3 mb-6",children:w.map(((e,t)=>(0,Lt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,Lt.jsx)("h4",{className:"font-medium",children:e.menu_item_name}),(0,Lt.jsx)("button",{onClick:()=>ue(t),className:"text-red-600 hover:text-red-800 text-sm",children:"\xd7"})]}),e.modifiers.length>0&&(0,Lt.jsx)("div",{className:"text-xs text-gray-600 mb-2",children:e.modifiers.map((e=>e.name)).join(", ")}),(0,Lt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("button",{onClick:()=>ce(t,e.quantity-1),className:"w-6 h-6 bg-gray-200 rounded text-sm hover:bg-gray-300",children:"-"}),(0,Lt.jsx)("span",{className:"w-8 text-center",children:e.quantity}),(0,Lt.jsx)("button",{onClick:()=>ce(t,e.quantity+1),className:"w-6 h-6 bg-gray-200 rounded text-sm hover:bg-gray-300",children:"+"})]}),(0,Lt.jsxs)("span",{className:"font-medium",children:["$",e.total_price.toFixed(2)]})]})]},t)))}),(0,Lt.jsxs)("div",{className:"border-t pt-4 space-y-2 mb-6",children:[(0,Lt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Lt.jsx)("span",{children:"Subtotal:"}),(0,Lt.jsxs)("span",{children:["$",he.toFixed(2)]})]}),(0,Lt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Lt.jsx)("span",{children:"Tax (8%):"}),(0,Lt.jsxs)("span",{children:["$",ge.toFixed(2)]})]}),(0,Lt.jsxs)("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[(0,Lt.jsx)("span",{children:"Total:"}),(0,Lt.jsxs)("span",{children:["$",be.toFixed(2)]})]})]}),(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes"}),(0,Lt.jsx)("textarea",{value:W,onChange:e=>V(e.target.value),placeholder:"Add special instructions or comments for this order...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),(0,Lt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"These notes will appear on the receipt"})]}),(0,Lt.jsxs)("div",{className:"space-y-3",children:[(0,Lt.jsx)("button",{onClick:async()=>{let e=S;(e||(e=await fe(),e))&&U(!0)},className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 text-lg font-semibold",children:"Checkout"}),(0,Lt.jsx)("button",{onClick:async()=>{let e=S;if(e)try{await pe(),alert("Order updated successfully!"),l()}catch(o){var t,n;console.error("Error updating order:",o),alert((null===(t=o.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.detail)||"Error updating order")}else{if(e=await fe(),!e)return;try{await Rt.post("".concat(It,"/orders/").concat(e.id,"/send")),alert("Order sent successfully!"),l()}catch(o){var r,a;console.error("Error sending order:",o),alert((null===(r=o.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.detail)||"Error sending order")}}},className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 font-semibold",children:"Send"}),(0,Lt.jsx)("button",{onClick:async()=>{if(i)try{const e=S||u(u({},de()),{},{items:w,customer_name:j.name,customer_phone:j.phone,customer_address:j.address,order_type:P,table_number:(null===X||void 0===X?void 0:X.number)||(null===t||void 0===t?void 0:t.number),created_at:(new Date).toISOString(),order_number:"TEMP-".concat(Date.now())});await s(e)}catch(e){console.error("Print receipt error:",e),alert("Failed to print receipt. Please check printer connection.")}else{window.confirm("Printer not connected. Would you like to set up the printer now?")&&c()}},className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 font-semibold",children:"Print Receipt"})]})]})]}),A&&L&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Customize ",L.name]}),L.modifier_groups&&L.modifier_groups.length>0?L.modifier_groups.map((e=>{const t=p.find((t=>t.id===e));if(!t)return null;const n=h.filter((t=>t.group_id===e));return(0,Lt.jsxs)("div",{className:"mb-4",children:[(0,Lt.jsxs)("h4",{className:"font-medium mb-2",children:[t.name," ",t.required&&(0,Lt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,Lt.jsx)("div",{className:"space-y-2",children:n.map((n=>(0,Lt.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("input",{type:1===t.max_selections?"radio":"checkbox",name:"group-".concat(e),onChange:r=>{const a=u({},F);a[e]||(a[e]=[]),1===t.max_selections?a[e]=r.target.checked?[n.id]:[]:r.target.checked?a[e].push(n.id):a[e]=a[e].filter((e=>e!==n.id)),M(a)}}),(0,Lt.jsx)("span",{className:"flex-1",children:n.name}),n.price>0&&(0,Lt.jsxs)("span",{className:"text-green-600",children:["+$",n.price.toFixed(2)]})]},n.id)))})]},e)})):(0,Lt.jsx)("p",{className:"text-gray-500 mb-4",children:"No modifiers available for this item."}),(0,Lt.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,Lt.jsx)("button",{onClick:()=>z(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400",children:"Cancel"}),(0,Lt.jsx)("button",{onClick:()=>{if(!L)return;const e=[];let t=0;Object.entries(F).forEach((n=>{let[r,a]=n;a.forEach((n=>{const r=h.find((e=>e.id===n));r&&(e.push({modifier_id:r.id,name:r.name,price:r.price}),t+=r.price)}))}));const n={menu_item_id:L.id,menu_item_name:L.name,quantity:1,base_price:L.price,modifiers:e,total_price:L.price+t};k([...w,n]),z(!1),D(null)},className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",children:"Add to Cart"})]})]})}),(0,Lt.jsx)(on,{isOpen:I,order:S||u(u({},de()),{},{id:"temp"}),onClose:()=>U(!1),onPaymentComplete:()=>{U(!1),l()}}),(0,Lt.jsx)(sn,{isOpen:B,onClose:()=>q(!1),onRemove:async e=>{if(S)try{await Rt.delete("".concat(It,"/orders/").concat(S.id,"/items/").concat($),{data:e}),ae()}catch(t){console.error("Error removing item from order:",t)}else{const e=w.filter(((e,t)=>t!==$));k(e)}}}),Q&&(0,Lt.jsx)(Zt,{customer:{},onSave:async e=>{try{const t=(await Rt.post("".concat(It,"/customers"),e)).data;C({name:t.name,phone:t.phone,address:t.address,apartment:""}),E(!0),K(!1),alert("Customer added successfully!")}catch(t){console.error("Error adding customer:",t),alert("Error adding customer")}},onClose:()=>K(!1)}),Y&&(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Lt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Select Table"}),(0,Lt.jsx)("button",{onClick:()=>G(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]}),(0,Lt.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Z.map((e=>(0,Lt.jsxs)("button",{onClick:()=>{"occupied"===e.status?window.confirm("Table ".concat(e.number," is occupied. Do you want to merge orders with this table?"))&&(J(e),G(!1),alert("Order will be merged with Table ".concat(e.number))):(J(e),G(!1))},className:"p-4 rounded-lg border-2 text-center font-medium transition-colors ".concat("available"===e.status?"border-green-500 bg-green-50 text-green-700 hover:bg-green-100":"occupied"===e.status?"border-orange-500 bg-orange-50 text-orange-700 hover:bg-orange-100":"border-red-500 bg-red-50 text-red-700 cursor-not-allowed"),disabled:"cleaning"===e.status,children:[(0,Lt.jsxs)("div",{className:"text-lg font-bold",children:["Table ",e.number]}),(0,Lt.jsx)("div",{className:"text-sm capitalize",children:e.status}),"occupied"===e.status&&(0,Lt.jsx)("div",{className:"text-xs mt-1",children:"Click to merge"})]},e.id)))})]})})]})},un=e=>{let{order:t,onClose:n}=e;const{printOrderReceipt:r,connected:a,openPrinterManager:l}=Ft();if(!t)return null;return(0,Lt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Lt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-lg w-full max-h-96 overflow-y-auto",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,Lt.jsxs)("h3",{className:"text-xl font-bold",children:["Order ",t.order_number]}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Lt.jsxs)("button",{onClick:async()=>{if(a)try{await r(t)}catch(e){alert("Failed to print receipt. Please check printer connection.")}else{window.confirm("Printer not connected. Would you like to set up the printer now?")&&l()}},className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 flex items-center space-x-1",children:[(0,Lt.jsx)("span",{children:"\ud83d\udda8\ufe0f"}),(0,Lt.jsx)("span",{children:"Print"})]}),(0,Lt.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 text-xl",children:"\xd7"})]})]}),(0,Lt.jsxs)("div",{className:"space-y-4",children:[(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Order Details"}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Type:"})," ",t.order_type.replace("_"," ").toUpperCase()]}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Status:"})," ",t.status.replace("_"," ").toUpperCase()]}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Time:"})," ",Kt(t.created_at)]}),t.table_number&&(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Table:"})," ",t.table_number]})]}),t.customer_name&&(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Customer Information"}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Name:"})," ",t.customer_name]}),t.customer_phone&&(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Phone:"})," ",t.customer_phone]}),t.customer_address&&(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Address:"})," ",t.customer_address]})]}),t.order_notes&&(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Order Notes"}),(0,Lt.jsx)("p",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:t.order_notes})]}),(0,Lt.jsxs)("div",{children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Items"}),t.items.map(((e,t)=>(0,Lt.jsxs)("div",{className:"border-b pb-2 mb-2",children:[(0,Lt.jsxs)("div",{className:"flex justify-between",children:[(0,Lt.jsxs)("span",{children:[e.quantity,"x ",e.menu_item_name]}),(0,Lt.jsxs)("span",{children:["$",e.total_price.toFixed(2)]})]}),e.modifiers&&e.modifiers.length>0&&(0,Lt.jsx)("div",{className:"text-sm text-gray-600 ml-4",children:e.modifiers.map((e=>e.name)).join(", ")})]},t)))]}),(0,Lt.jsxs)("div",{className:"border-t pt-4",children:[(0,Lt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Lt.jsx)("span",{children:"Subtotal:"}),(0,Lt.jsxs)("span",{children:["$",t.subtotal.toFixed(2)]})]}),(0,Lt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Lt.jsx)("span",{children:"Tax:"}),(0,Lt.jsxs)("span",{children:["$",t.tax.toFixed(2)]})]}),t.tip>0&&(0,Lt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Lt.jsx)("span",{children:"Tip:"}),(0,Lt.jsxs)("span",{children:["$",t.tip.toFixed(2)]})]}),(0,Lt.jsxs)("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[(0,Lt.jsx)("span",{children:"Total:"}),(0,Lt.jsxs)("span",{children:["$",t.total.toFixed(2)]})]}),t.payment_method&&(0,Lt.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,Lt.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Payment Information"}),(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Method:"})," ",t.payment_method.toUpperCase()]}),t.change_amount>0&&(0,Lt.jsxs)("p",{children:[(0,Lt.jsx)("strong",{children:"Change Given:"})," $",t.change_amount.toFixed(2)]})]})]})]})]})})},dn=()=>{const[e,t]=(0,a.useState)("main"),[n,r]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[p,m]=(0,a.useState)(0),[h,g]=(0,a.useState)(!1),{user:b,logout:y}=qt(),{connected:x,openPrinterManager:v}=Ft(),w=e=>{g(!0),"available"===e.status?(f(e),o(null),i(null)):"occupied"===e.status&&(o(e),f(null),i(null)),t("new-order")},k=()=>{t("main"),f(null),o(null),i(null),m((e=>e+1))};return"new-order"===e?(0,Lt.jsx)(cn,{selectedTable:d,editingOrder:l,editingActiveOrder:s,onBack:k,fromTableManagement:h}):"order-history"===e?(0,Lt.jsx)(en,{onBack:k}):"customerManagement"===e?(0,Lt.jsx)(Xt,{onBack:k}):"table-management"===e?(0,Lt.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Lt.jsx)("div",{className:"bg-white shadow-sm border-b p-4",children:(0,Lt.jsx)("div",{className:"flex items-center justify-between",children:(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsxs)("button",{onClick:k,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800",children:[(0,Lt.jsx)("span",{children:"\u2190"}),(0,Lt.jsx)("span",{children:"Back"})]}),(0,Lt.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Table Management"})]})})}),(0,Lt.jsx)("div",{className:"p-6",children:(0,Lt.jsx)(ln,{onTableSelect:w})})]}):(0,Lt.jsxs)("div",{className:"bg-gray-50 min-h-screen",children:[(0,Lt.jsx)("div",{className:"bg-white shadow-sm border-b p-4",children:(0,Lt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Lt.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Restaurant POS"}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsxs)("button",{onClick:v,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(x?"bg-green-100 text-green-700 hover:bg-green-200":"bg-red-100 text-red-700 hover:bg-red-200"),children:[(0,Lt.jsx)("span",{children:"\ud83d\udda8\ufe0f"}),(0,Lt.jsx)("span",{children:x?"Printer Connected":"Setup Printer"})]}),(0,Lt.jsxs)("span",{className:"text-sm text-gray-600",children:["Welcome, ",null===b||void 0===b?void 0:b.full_name," (",null===b||void 0===b?void 0:b.role,")"]}),"manager"===(null===b||void 0===b?void 0:b.role)&&(0,Lt.jsx)(rn,{}),(0,Lt.jsx)(an,{}),(0,Lt.jsx)("button",{onClick:y,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Logout"})]})]})}),(0,Lt.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Lt.jsxs)("div",{className:"flex space-x-4 flex-wrap",children:[(0,Lt.jsx)("button",{onClick:()=>function(){f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),o(null),i(null),g(!1),t("new-order")}(),className:"bg-blue-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition-colors shadow-lg",children:"+ New Order"}),(0,Lt.jsx)("button",{onClick:()=>{t("order-history")},className:"bg-purple-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-purple-700 transition-colors shadow-lg",children:"\ud83d\udccb Order History"}),(0,Lt.jsx)("button",{onClick:()=>{t("table-management")},className:"bg-green-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-green-700 transition-colors shadow-lg",children:"\ud83c\udfd3 Table Management"}),(0,Lt.jsx)("button",{onClick:()=>t("customerManagement"),className:"bg-purple-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-purple-700 transition-colors shadow-lg",children:"\ud83d\udc65 Customer Management"}),(0,Lt.jsx)("button",{onClick:v,className:"px-8 py-4 rounded-xl text-lg font-semibold transition-colors shadow-lg ".concat(x?"bg-green-600 text-white hover:bg-green-700":"bg-orange-600 text-white hover:bg-orange-700"),children:"\ud83d\udda8\ufe0f Printer Manager"})]}),(0,Lt.jsx)(tn,{onOrderClick:e=>{i(e),f(null),o(null),t("new-order")},refreshTrigger:p})]})]})};const fn=()=>{const{isAuthenticated:e}=qt();return(0,Lt.jsx)("div",{className:"App",children:e?(0,Lt.jsx)(dn,{}):(0,Lt.jsx)($t,{})})},pn=function(){return(0,Lt.jsx)(Bt,{children:(0,Lt.jsx)(Mt,{children:(0,Lt.jsx)(fn,{})})})};l.createRoot(document.getElementById("root")).render((0,Lt.jsx)(a.StrictMode,{children:(0,Lt.jsx)(pn,{})}))})();
//# sourceMappingURL=main.8bf3aca3.js.map